import org.springframework.beans.factory.annotation.Value
import org.springframework.dao.DataIntegrityViolationException
import org.transmart.searchapp.SecureObjectPath

class SecureObjectPathController {

	static allowedMethods = [delete: 'POST', save: 'POST', update: 'POST']
	static defaultAction = 'list'

	@Value('${com.recomdata.admin.paginate.max:0}')
	private int paginateMax

	def list() {
		params.max = Math.min(params.int('max', paginateMax), 100)
		[secureObjectPathInstanceList: SecureObjectPath.list(params), secureObjectPathInstanceTotal: SecureObjectPath.count()]
	}

	def show(SecureObjectPath secureObjectPath) {
		if (secureObjectPath) {
			[secureObjectPathInstance: secureObjectPath]
		}
		else {
			flash.message = "SecureObjectPath not found with id ${params.id}"
			redirect action: 'list'
		}
	}

	def delete(SecureObjectPath secureObjectPath) {
		if (secureObjectPath) {
			try {
				secureObjectPath.delete()
				flash.message = "SecureObjectPath ${params.id} deleted"
				redirect action: 'list'
			}
			catch (DataIntegrityViolationException e) {
				flash.message = "SecureObjectPath ${params.id} could not be deleted"
				redirect action: 'show', id: params.id
			}
		}
		else {
			flash.message = "SecureObjectPath not found with id ${params.id}"
			redirect action: 'list'
		}
	}

	def edit(SecureObjectPath secureObjectPath) {
		if (secureObjectPath) {
			[secureObjectPathInstance: secureObjectPath]
		}
		else {
			flash.message = "SecureObjectPath not found with id ${params.id}"
			redirect action: 'list'
		}
	}

	def update(SecureObjectPath secureObjectPath) {
		if (secureObjectPath) {
			if (params.version) {
				long version = params.long('version', 0)
				if (secureObjectPath.version > version) {
					secureObjectPath.errors.rejectValue 'version',
							'secureObjectPath.optimistic.locking.failure',
							'Another user has updated this SecureObjectPath while you were editing.'
					render view: 'edit', model: [secureObjectPathInstance: secureObjectPath]
					return
				}
			}

			secureObjectPath.properties = params
			if (!secureObjectPath.hasErrors() && secureObjectPath.save()) {
				flash.message = "SecureObjectPath ${params.id} updated"
				redirect action: 'show', id: secureObjectPath.id
			}
			else {
				render view: 'edit', model: [secureObjectPathInstance: secureObjectPath]
			}
		}
		else {
			flash.message = "SecureObjectPath not found with id ${params.id}"
			redirect action: 'edit', id: params.id
		}
	}

	def create() {
		[secureObjectPathInstance: new SecureObjectPath(params)]
	}

	def save() {
		SecureObjectPath secureObjectPath = new SecureObjectPath(params)
		if (!secureObjectPath.hasErrors() && secureObjectPath.save()) {
			flash.message = "SecureObjectPath ${secureObjectPath.id} created"
			redirect action: 'show', id: secureObjectPath.id
		}
		else {
			render view: 'create', model: [secureObjectPathInstance: secureObjectPath]
		}
	}
}
